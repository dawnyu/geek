import{_ as s,C as n,o as a,c as l,H as p,w as o,k as e,a as c,Q as r}from"./chunks/framework.e34e23c1.js";const t=JSON.parse('{"title":"nodeå®ç°äº‘å‡½æ•°","description":"","frontmatter":{"layout":"Article","title":"nodeå®ç°äº‘å‡½æ•°","date":"2023/10/01","tags":"Node","category":"æŠ€æœ¯ä¸“æ ","preview":"/common/62.jpg","intro":"äº‘å‡½æ•°æ˜¯ä¸€ç§æ— æœåŠ¡å™¨è®¡ç®—æ¨¡å‹ï¼Œå®ƒå…è®¸ä½ åœ¨éœ€è¦æ—¶è¿è¡Œä»£ç ï¼Œè€Œæ— éœ€ç®¡ç†æœåŠ¡å™¨çš„åŸºç¡€æ¶æ„ã€‚å®ƒé€‚ç”¨äºå„ç§åœºæ™¯ï¼ŒåŒ…æ‹¬äº‹ä»¶é©±åŠ¨å‹çš„ä»»åŠ¡ï¼Œå¦‚å“åº” HTTP è¯·æ±‚ã€å¤„ç†é˜Ÿåˆ—ç­‰ã€‚"},"headers":[],"relativePath":"article/nodeå®ç°äº‘å‡½æ•°.md","filePath":"å…¨éƒ¨æ–‡æ¡£/æŠ€æœ¯ä¸“æ /å‰ç«¯/nodeå®ç°äº‘å‡½æ•°.md","lastUpdated":1696947851000}'),E={name:"article/nodeå®ç°äº‘å‡½æ•°.md"},y=e("h1",{id:"nodeå®ç°äº‘å‡½æ•°",tabindex:"-1"},[c("nodeå®ç°äº‘å‡½æ•° "),e("a",{class:"header-anchor",href:"#nodeå®ç°äº‘å‡½æ•°","aria-label":'Permalink to "nodeå®ç°äº‘å‡½æ•°"'},"â€‹")],-1),i=r('<p>äº‘å‡½æ•°æ˜¯ä¸€ç§æ— æœåŠ¡å™¨è®¡ç®—æ¨¡å‹ï¼Œå®ƒå…è®¸ä½ åœ¨éœ€è¦æ—¶è¿è¡Œä»£ç ï¼Œè€Œæ— éœ€ç®¡ç†æœåŠ¡å™¨çš„åŸºç¡€æ¶æ„ã€‚å®ƒé€‚ç”¨äºå„ç§åœºæ™¯ï¼ŒåŒ…æ‹¬äº‹ä»¶é©±åŠ¨å‹çš„ä»»åŠ¡ï¼Œå¦‚å“åº” HTTP è¯·æ±‚ã€å¤„ç†é˜Ÿåˆ—ç­‰ã€‚ ä¸¾ä¸ªğŸŒ°ï¼š</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// ç¤ºä¾‹ï¼šç®€å•çš„äº‘å‡½æ•°</span></span>\n<span class="line"><span style="color:#79B8FF;">exports</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">handler</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">event</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">message</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;ç¬¬ä¸€ä¸ªäº‘å‡½æ•°&quot;</span><span style="color:#E1E4E8;">;</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> {</span></span>\n<span class="line"><span style="color:#E1E4E8;">    statusCode: </span><span style="color:#79B8FF;">200</span><span style="color:#E1E4E8;">,</span></span>\n<span class="line"><span style="color:#E1E4E8;">    body: { message, event },</span></span>\n<span class="line"><span style="color:#E1E4E8;">  };</span></span>\n<span class="line"><span style="color:#E1E4E8;">};</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// ç¤ºä¾‹ï¼šç®€å•çš„äº‘å‡½æ•°</span></span>\n<span class="line"><span style="color:#005CC5;">exports</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">handler</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">async</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">event</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">message</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;ç¬¬ä¸€ä¸ªäº‘å‡½æ•°&quot;</span><span style="color:#24292E;">;</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> {</span></span>\n<span class="line"><span style="color:#24292E;">    statusCode: </span><span style="color:#005CC5;">200</span><span style="color:#24292E;">,</span></span>\n<span class="line"><span style="color:#24292E;">    body: { message, event },</span></span>\n<span class="line"><span style="color:#24292E;">  };</span></span>\n<span class="line"><span style="color:#24292E;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h1 id="å¸¸è§çš„äº‘å¼€å‘æ–¹å¼" tabindex="-1">å¸¸è§çš„äº‘å¼€å‘æ–¹å¼ <a class="header-anchor" href="#å¸¸è§çš„äº‘å¼€å‘æ–¹å¼" aria-label="Permalink to &quot;å¸¸è§çš„äº‘å¼€å‘æ–¹å¼&quot;">â€‹</a></h1>',3),F=e("ul",null,[e("li",null,"å°ç¨‹åºäº‘å¼€å‘"),e("li",null,"è…¾è®¯äº‘serverless"),e("li",null,"BFFæœåŠ¡ç¼–æ’ç­‰")],-1),u=e("h1",{id:"ä¸æƒ³èŠ±é’±æ€ä¹ˆæ",tabindex:"-1"},[c("ä¸æƒ³èŠ±é’±æ€ä¹ˆæï¼Ÿ "),e("a",{class:"header-anchor",href:"#ä¸æƒ³èŠ±é’±æ€ä¹ˆæ","aria-label":'Permalink to "ä¸æƒ³èŠ±é’±æ€ä¹ˆæï¼Ÿ"'},"â€‹")],-1),d=r('<p>è‡ªå·±æ’¸ä¸€ä¸ªä¸å°±å¾—äº†ğŸ˜~</p><h2 id="å…ˆäº†è§£ä¸‹æ²™ç®±" tabindex="-1">å…ˆäº†è§£ä¸‹æ²™ç®± <a class="header-anchor" href="#å…ˆäº†è§£ä¸‹æ²™ç®±" aria-label="Permalink to &quot;å…ˆäº†è§£ä¸‹æ²™ç®±&quot;">â€‹</a></h2><p>æ²™ç®±æ˜¯ä¸€ä¸ªè®¡ç®—æœºå®‰å…¨æ¦‚å¿µï¼Œç”¨äºéš”ç¦»å’Œä¿æŠ¤ä¸€ä¸ªç¨‹åºæˆ–ä¸€æ®µä»£ç ä¸å—å…¶ä»–ç¨‹åºæˆ–ç³»ç»Ÿçš„å½±å“ï¼Œä»¥ç¡®ä¿å…¶å®‰å…¨æ€§å’Œç¨³å®šæ€§ã€‚æ²™ç®±æŠ€æœ¯é€šå¸¸è¢«ç”¨æ¥è¿è¡Œä¸å—ä¿¡ä»»çš„ä»£ç ï¼Œå¦‚ç”¨æˆ·æäº¤çš„è„šæœ¬æˆ–ç¬¬ä¸‰æ–¹æ’ä»¶ï¼ŒåŒæ—¶é™åˆ¶å…¶å¯¹ç³»ç»Ÿå’Œèµ„æºçš„è®¿é—®æƒé™ã€‚</p><ol><li><strong>éš”ç¦»æ€§ï¼š</strong> æ²™ç®±é€šè¿‡åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„æ‰§è¡Œç¯å¢ƒï¼Œå°†è¿è¡Œçš„ä»£ç ä¸ä¸»ç³»ç»Ÿæˆ–å…¶ä»–ä»£ç éš”ç¦»å¼€æ¥ã€‚è¿™æ„å‘³ç€åœ¨æ²™ç®±ä¸­è¿è¡Œçš„ä»£ç æ— æ³•ç›´æ¥è®¿é—®ä¸»ç³»ç»Ÿçš„èµ„æºæˆ–å…¶ä»–è¿›ç¨‹çš„æ•°æ®ã€‚</li><li><strong>èµ„æºé™åˆ¶ï¼š</strong> æ²™ç®±å¯ä»¥å¯¹è¿è¡Œçš„ä»£ç æ–½åŠ èµ„æºé™åˆ¶ï¼Œä¾‹å¦‚å†…å­˜ã€CPU ä½¿ç”¨é‡å’Œæ–‡ä»¶ç³»ç»Ÿè®¿é—®æƒé™ã€‚è¿™æœ‰åŠ©äºé˜²æ­¢ä»£ç è€—å°½ç³»ç»Ÿèµ„æºæˆ–æ‰§è¡Œæ¶æ„æ“ä½œã€‚</li><li><strong>æƒé™æ§åˆ¶ï¼š</strong> æ²™ç®±å¯ä»¥æ ¹æ®éœ€è¦å¯¹ä»£ç çš„æƒé™è¿›è¡Œç²¾ç»†çš„æ§åˆ¶ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥æŒ‡å®šå“ªäº›ç³»ç»Ÿèµ„æºå’ŒåŠŸèƒ½å¯ç”¨äºè¿è¡Œçš„ä»£ç ï¼Œå“ªäº›ä¸å¯ç”¨ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥é™åˆ¶ç½‘ç»œè®¿é—®æˆ–æ–‡ä»¶è®¿é—®æƒé™ã€‚</li><li><strong>é”™è¯¯éš”ç¦»ï¼š</strong> å¦‚æœåœ¨æ²™ç®±ä¸­è¿è¡Œçš„ä»£ç å‘ç”Ÿé”™è¯¯æˆ–å´©æºƒï¼Œå®ƒé€šå¸¸ä¸ä¼šå½±å“åˆ°ä¸»ç³»ç»Ÿæˆ–å…¶ä»–ä»£ç ã€‚æ²™ç®±æä¾›äº†é”™è¯¯éš”ç¦»ï¼Œç¡®ä¿é—®é¢˜å±€é™åœ¨æ²™ç®±å†…éƒ¨ã€‚</li><li><strong>å®‰å…¨æ€§ï¼š</strong> æ²™ç®±ç”¨äºè¿è¡Œä¸å—ä¿¡ä»»çš„ä»£ç ï¼Œä»¥å‡å°‘æ½œåœ¨çš„å®‰å…¨æ¼æ´å’Œæ”»å‡»ã€‚é€šè¿‡é™åˆ¶ä»£ç çš„è®¿é—®æƒé™ï¼Œå¯ä»¥é™ä½æ½œåœ¨é£é™©ã€‚</li><li><strong>å¤šç”¨é€”æ€§ï¼š</strong> æ²™ç®±ä¸ä»…ç”¨äºè¿è¡Œä¸å—ä¿¡ä»»çš„ä»£ç ï¼Œè¿˜å¯ä»¥ç”¨äºæµ‹è¯•ã€è°ƒè¯•å’Œéš”ç¦»åº”ç”¨ç¨‹åºçš„ä¸åŒéƒ¨åˆ†ã€‚</li></ol><h2 id="å‡ ç§å®ç°æ²™ç®±ç¯å¢ƒçš„æ–¹æ³•" tabindex="-1">å‡ ç§å®ç°æ²™ç®±ç¯å¢ƒçš„æ–¹æ³• <a class="header-anchor" href="#å‡ ç§å®ç°æ²™ç®±ç¯å¢ƒçš„æ–¹æ³•" aria-label="Permalink to &quot;å‡ ç§å®ç°æ²™ç®±ç¯å¢ƒçš„æ–¹æ³•&quot;">â€‹</a></h2><p><strong>vm</strong> vmæ˜¯nodeå†…ç½®æ¨¡å—ä¹‹ä¸€ï¼Œç”¨äºåˆ›å»ºè™šæ‹Ÿæœºç¯å¢ƒï¼Œä»¥ä¾¿åœ¨å…¶ä¸­è¿è¡Œ JavaScript ä»£ç ã€‚è™šæ‹Ÿæœºç¯å¢ƒæä¾›äº†éš”ç¦»å’Œå®‰å…¨æ€§ï¼Œå…è®¸ä½ åœ¨ä¸æ±¡æŸ“å½“å‰ Node.js è¿›ç¨‹çš„å…¨å±€ç¯å¢ƒçš„æƒ…å†µä¸‹æ‰§è¡Œä»£ç ã€‚ï¼› ç›¸å¯¹äºevalï¼ŒFunctionæ¥è¯´ï¼Œå®‰å…¨æ€§ä¹Ÿæ›´å¥½ä¸€ç‚¹ï¼›</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">eval</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;1+2&#39;</span><span style="color:#E1E4E8;">) </span><span style="color:#6A737D;">// 3</span></span>\n<span class="line"><span style="color:#E1E4E8;">func </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Function</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;a&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;b&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;return a+b&#39;</span><span style="color:#E1E4E8;">)</span></span>\n<span class="line"><span style="color:#B392F0;">func</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">)</span><span style="color:#6A737D;">// 3</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#6A737D;">// ä½¿ç”¨vm</span></span>\n<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">vm</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;vm&#39;</span><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">context</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span></span>\n<span class="line"><span style="color:#E1E4E8;">  x: </span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;">,</span></span>\n<span class="line"><span style="color:#E1E4E8;">  y: </span><span style="color:#79B8FF;">20</span></span>\n<span class="line"><span style="color:#E1E4E8;">};</span></span>\n<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">code</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">`</span></span>\n<span class="line"><span style="color:#9ECBFF;">  const result = x + y;</span></span>\n<span class="line"><span style="color:#9ECBFF;">  result;</span></span>\n<span class="line"><span style="color:#9ECBFF;">`</span><span style="color:#E1E4E8;">;</span></span>\n<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">result</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> vm.</span><span style="color:#B392F0;">runInNewContext</span><span style="color:#E1E4E8;">(code, context);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">eval</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;1+2&#39;</span><span style="color:#24292E;">) </span><span style="color:#6A737D;">// 3</span></span>\n<span class="line"><span style="color:#24292E;">func </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Function</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;a&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;b&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;return a+b&#39;</span><span style="color:#24292E;">)</span></span>\n<span class="line"><span style="color:#6F42C1;">func</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">)</span><span style="color:#6A737D;">// 3</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#6A737D;">// ä½¿ç”¨vm</span></span>\n<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">vm</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;vm&#39;</span><span style="color:#24292E;">);</span></span>\n<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">context</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span></span>\n<span class="line"><span style="color:#24292E;">  x: </span><span style="color:#005CC5;">10</span><span style="color:#24292E;">,</span></span>\n<span class="line"><span style="color:#24292E;">  y: </span><span style="color:#005CC5;">20</span></span>\n<span class="line"><span style="color:#24292E;">};</span></span>\n<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">code</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">`</span></span>\n<span class="line"><span style="color:#032F62;">  const result = x + y;</span></span>\n<span class="line"><span style="color:#032F62;">  result;</span></span>\n<span class="line"><span style="color:#032F62;">`</span><span style="color:#24292E;">;</span></span>\n<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">result</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> vm.</span><span style="color:#6F42C1;">runInNewContext</span><span style="color:#24292E;">(code, context);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>VMå¸¸ç”¨çš„apiï¼š</p><ol><li><strong>vm.createContext(sandbox)</strong>: åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå¯ç”¨äºåœ¨è™šæ‹Ÿæœºä¸­æ‰§è¡Œä»£ç ã€‚<strong>sandbox</strong> å‚æ•°æ˜¯ä¸€ä¸ªå¯é€‰çš„å¯¹è±¡ï¼Œå®ƒä¼šè¢«æ³¨å…¥åˆ°è™šæ‹Ÿæœºçš„å…¨å±€ä½œç”¨åŸŸä¸­ï¼Œå¯ä»¥åœ¨å…¶ä¸­è®¿é—®å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•ã€‚</li><li><strong>vm.runInContext(code, context, options)</strong>: åœ¨æŒ‡å®šçš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­æ‰§è¡Œ JavaScript ä»£ç ã€‚<strong>code</strong> å‚æ•°æ˜¯è¦æ‰§è¡Œçš„ä»£ç å­—ç¬¦ä¸²ï¼Œ<strong>context</strong> å‚æ•°æ˜¯ç”± <strong>vm.createContext</strong> åˆ›å»ºçš„ä¸Šä¸‹æ–‡å¯¹è±¡ã€‚<strong>options</strong> å‚æ•°æ˜¯ä¸€ä¸ªå¯é€‰çš„é…ç½®ï¼Œå¯å‚è€ƒå®˜ç½‘ï¼›</li><li><strong>vm.runInThisContext(code, options)</strong>: åœ¨å½“å‰ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­æ‰§è¡Œ JavaScript ä»£ç ã€‚ä¸éœ€è¦æŒ‡å®šä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œä»£ç å°†åœ¨å½“å‰ç¯å¢ƒä¸­æ‰§è¡Œã€‚</li></ol><p><strong>runInThisContext</strong>ä¼šåœ¨å½“å‰ä¸Šä¸‹æ–‡ä¸­æ‰§è¡ŒJavaScript ä»£ç ï¼Œèƒ½å¤Ÿè®¿é—®å…¨å±€å˜é‡å’Œå…¨å±€å‡½æ•°ã€‚ ä¸€èˆ¬ç”¨äºåŠ¨æ€åŠ è½½ï¼Œæ¯”å¦‚ï¼š</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">code</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fs.</span><span style="color:#B392F0;">readFileSync</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;externalScript.js&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;utf8&#39;</span><span style="color:#E1E4E8;">); </span></span>\n<span class="line"><span style="color:#E1E4E8;">vm.</span><span style="color:#B392F0;">runInThisContext</span><span style="color:#E1E4E8;">(code);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">code</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fs.</span><span style="color:#6F42C1;">readFileSync</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;externalScript.js&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;utf8&#39;</span><span style="color:#24292E;">); </span></span>\n<span class="line"><span style="color:#24292E;">vm.</span><span style="color:#6F42C1;">runInThisContext</span><span style="color:#24292E;">(code);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="4"><li><strong>vm.runInNewContext(code, sandbox, options)</strong>: åœ¨æ–°çš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­æ‰§è¡Œ JavaScript ä»£ç ã€‚ä¸ <strong>runInContext</strong> ç±»ä¼¼ï¼Œä½†ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œè€Œä¸æ˜¯åœ¨ç°æœ‰çš„ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œã€‚</li></ol><p>ä»¥ä¸Šéƒ½æ˜¯ç›´æ¥æ‰§è¡Œï¼Œä¸ä¼šè¿”å›ç¼–è¯‘åçš„ä»£ç ï¼›ä¸‹é¢å‡ ä¸ªapiæ˜¯å…ˆç¼–è¯‘åï¼Œå¯ä»¥åœ¨ç¨‹åºä¸­å¤šæ¬¡æ‰§è¡Œï¼›</p><ol start="5"><li><strong>vm.createScript(code, options)</strong>: åˆ›å»ºä¸€ä¸ª <strong>Script</strong> å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«è¦æ‰§è¡Œçš„ JavaScript ä»£ç ã€‚<strong>code</strong> å‚æ•°æ˜¯ä»£ç å­—ç¬¦ä¸²ï¼Œ<strong>options</strong> å‚æ•°æ˜¯ä¸€ä¸ªå¯é€‰çš„é€‰é¡¹å¯¹è±¡ã€‚</li><li><strong>Script.runInContext(contextifiedSandbox, options)</strong>: åœ¨æŒ‡å®šçš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­æ‰§è¡Œ <strong>Script</strong> å¯¹è±¡ä¸­åŒ…å«çš„ä»£ç ã€‚</li></ol><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">script</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> vm1.</span><span style="color:#B392F0;">createScript</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">`var a = 1;a;`</span><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">content</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> vm1.</span><span style="color:#B392F0;">createContext</span><span style="color:#E1E4E8;">({});</span></span>\n<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">result</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> script.</span><span style="color:#B392F0;">runInContext</span><span style="color:#E1E4E8;">(content);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">script</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> vm1.</span><span style="color:#6F42C1;">createScript</span><span style="color:#24292E;">(</span><span style="color:#032F62;">`var a = 1;a;`</span><span style="color:#24292E;">);</span></span>\n<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">content</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> vm1.</span><span style="color:#6F42C1;">createContext</span><span style="color:#24292E;">({});</span></span>\n<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">result</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> script.</span><span style="color:#6F42C1;">runInContext</span><span style="color:#24292E;">(content);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="7"><li><strong>Script.runInNewContext(sandbox, options)</strong>: åœ¨æ–°çš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­æ‰§è¡Œ <strong>Script</strong> å¯¹è±¡ä¸­åŒ…å«çš„ä»£ç ã€‚</li><li><strong>Script.runInThisContext(options)</strong>: åœ¨å½“å‰ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­æ‰§è¡Œ <strong>Script</strong> å¯¹è±¡ä¸­åŒ…å«çš„ä»£ç ã€‚</li></ol><ul><li>ä¼˜ç‚¹ï¼š <ul><li>ç®€å•ï¼Œä¸éœ€è¦é¢å¤–çš„ä¾èµ–ã€‚</li><li>é€‚ç”¨äºä¸€äº›åŸºæœ¬çš„éš”ç¦»éœ€æ±‚ã€‚</li></ul></li><li>ç¼ºç‚¹ï¼š <ul><li>å®‰å…¨æ€§æœ‰é™ï¼Œä¸èƒ½æä¾›é«˜çº§çš„éš”ç¦»ï¼›</li></ul></li></ul><p>æ¯”å¦‚è¿™æ®µä»£ç ï¼š</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">code</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">`const fs = require(&#39;fs&#39;); const data = fs.readFileSync(&#39;/etc/passwd&#39;, &#39;utf8&#39;);console.log(data);`</span><span style="color:#E1E4E8;">;</span></span>\n<span class="line"><span style="color:#E1E4E8;">vm.</span><span style="color:#B392F0;">runInContext</span><span style="color:#E1E4E8;">(evilCode, context);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">code</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">`const fs = require(&#39;fs&#39;); const data = fs.readFileSync(&#39;/etc/passwd&#39;, &#39;utf8&#39;);console.log(data);`</span><span style="color:#24292E;">;</span></span>\n<span class="line"><span style="color:#24292E;">vm.</span><span style="color:#6F42C1;">runInContext</span><span style="color:#24292E;">(evilCode, context);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>vm2</strong><strong>vm2</strong> æ˜¯å¼€æºç¤¾åŒºæä¾›çš„ä¸€ä¸ªåº“ï¼Œå®ƒåŸºäºvmåœ¨ Node.js ä¸­åˆ›å»ºä¸€ä¸ªéš”ç¦»çš„ JavaScript æ‰§è¡Œç¯å¢ƒï¼Œé€šè¿‡es6æ–°å¢çš„ä»£ç†ï¼ˆProxyï¼‰æœºåˆ¶ï¼Œæ¥æ‹¦æˆªå¯¹å¤–éƒ¨å±æ€§çš„è®¿é—®ï¼ŒåŒæ—¶é™åˆ¶å¯¹æ•æ„Ÿèµ„æºçš„è®¿é—®ï¼Œå¯ä»¥è‡ªå®šä¹‰å…¨å±€å¯¹è±¡ï¼Œæä¾›å®‰å…¨é…ç½®å’Œé”™è¯¯å¤„ç†æ¥æé«˜ä»£ç çš„å®‰å…¨æ€§å’Œéš”ç¦»æ€§ã€‚ vm2 æä¾›3ä¸ªç±»ï¼š <strong>VMï¼š<strong>å…¶ä¸­</strong>VM</strong>åªæ”¯æŒç®€å•çš„JavaScriptä»£ç æ‰§è¡Œï¼Œä¸æ”¯æŒrequireï¼Œæ‰€ä»¥VMä¸æ”¯æŒCommonJSæ¨¡å—åŠ è½½ã€‚ **NodeVMï¼š**è¿™æ˜¯ <strong>vm2</strong> çš„æ ¸å¿ƒç±»ï¼Œç”¨äºåˆ›å»ºä¸€ä¸ªæ²™ç®±ç¯å¢ƒã€‚ <strong>VMScript</strong>ï¼šç”¨äºé¢„ç¼–è¯‘ JavaScript ä»£ç çš„ç±»ã€‚ <strong>NodeVMæ ¸å¿ƒæ–¹æ³•ï¼š</strong></p><ol><li><strong>vm.run(code: string)</strong>ï¼šåœ¨æ²™ç®±ç¯å¢ƒä¸­æ‰§è¡Œ JavaScript ä»£ç ï¼Œå¹¶è¿”å›æ‰§è¡Œç»“æœã€‚</li></ol><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">result</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> vm.</span><span style="color:#B392F0;">run</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;console.log(&quot;Hello from sandbox!&quot;);&#39;</span><span style="color:#E1E4E8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">result</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> vm.</span><span style="color:#6F42C1;">run</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;console.log(&quot;Hello from sandbox!&quot;);&#39;</span><span style="color:#24292E;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ol start="2"><li><strong>vm.runScript(script: VMScript)</strong>ï¼šè¿è¡Œä¸€ä¸ªé¢„ç¼–è¯‘çš„ <strong>VMScript</strong> å¯¹è±¡ï¼Œå¯ä»¥æé«˜æ‰§è¡Œæ•ˆç‡ã€‚</li></ol><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">script</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">VMScript</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;console.log(&quot;Hello from script!&quot;);&#39;</span><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">result</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> vm.</span><span style="color:#B392F0;">runScript</span><span style="color:#E1E4E8;">(script);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">script</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">VMScript</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;console.log(&quot;Hello from script!&quot;);&#39;</span><span style="color:#24292E;">);</span></span>\n<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">result</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> vm.</span><span style="color:#6F42C1;">runScript</span><span style="color:#24292E;">(script);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="3"><li><strong>vm.freeze(object: any, name: string)</strong>ï¼šå†»ç»“ä¸€ä¸ªå¯¹è±¡ï¼Œé˜»æ­¢å…¶åœ¨æ²™ç®±ä¸­è¢«ä¿®æ”¹ã€‚</li></ol><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">obj</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> { value: </span><span style="color:#79B8FF;">42</span><span style="color:#E1E4E8;"> };</span></span>\n<span class="line"><span style="color:#E1E4E8;">vm.</span><span style="color:#B392F0;">freeze</span><span style="color:#E1E4E8;">(obj, </span><span style="color:#9ECBFF;">&#39;obj&#39;</span><span style="color:#E1E4E8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">obj</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> { value: </span><span style="color:#005CC5;">42</span><span style="color:#24292E;"> };</span></span>\n<span class="line"><span style="color:#24292E;">vm.</span><span style="color:#6F42C1;">freeze</span><span style="color:#24292E;">(obj, </span><span style="color:#032F62;">&#39;obj&#39;</span><span style="color:#24292E;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="4"><li><strong>vm.unfreeze(name: string)</strong>ï¼šè§£å†»è¢«å†»ç»“çš„å¯¹è±¡ï¼Œå…è®¸å…¶åœ¨æ²™ç®±ä¸­è¢«ä¿®æ”¹ã€‚</li></ol><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">vm.</span><span style="color:#B392F0;">unfreeze</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;obj&#39;</span><span style="color:#E1E4E8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">vm.</span><span style="color:#6F42C1;">unfreeze</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;obj&#39;</span><span style="color:#24292E;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li><strong>ä¼˜ç‚¹ï¼š</strong></li></ul><ol><li><strong>ä¸Šä¸‹æ–‡éš”ç¦»</strong>ï¼š<strong>vm2</strong> ä½¿ç”¨å†…ç½® <strong>vm</strong> æ¨¡å—æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸Šä¸‹æ–‡æ‰§è¡Œç¯å¢ƒï¼Œä¸å½“å‰ Node.js åº”ç”¨ç¨‹åºçš„å…¨å±€ä¸Šä¸‹æ–‡å®Œå…¨éš”ç¦»ã€‚</li><li><strong>å®‰å…¨æ²™ç®±é…ç½®</strong>ï¼šé€šè¿‡é™åˆ¶è®¿é—® Node.js æ ¸å¿ƒæ¨¡å—ã€ç³»ç»Ÿæ¨¡å—å’Œä¸€äº›æ•æ„Ÿèµ„æºæ¥åˆ›å»ºæ²™ç®±ç¯å¢ƒã€‚ä¸èƒ½ç›´æ¥è®¿é—®æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œã€æ“ä½œç³»ç»Ÿå‘½ä»¤ç­‰æ•æ„ŸåŠŸèƒ½ï¼Œä»è€Œæé«˜äº†å®‰å…¨æ€§ã€‚ä½ å¯ä»¥é€‰æ‹©æ˜¯å¦å…è®¸ä»£ç è®¿é—®æŸäº›å…¨å±€å¯¹è±¡ã€è®¾ç½®æ‰§è¡Œæ—¶é—´é™åˆ¶ã€é™åˆ¶å†…å­˜ä½¿ç”¨ç­‰ã€‚</li><li><strong>è‡ªå®šä¹‰å…¨å±€å¯¹è±¡</strong>ï¼š é™åˆ¶äº†è®¿é—®æ ¸å¿ƒæ¨¡å—å’Œç³»ç»Ÿèµ„æºï¼Œä½†å®ƒå…è®¸ä½ å®šä¹‰è‡ªå·±çš„å…¨å±€å¯¹è±¡ï¼Œä»¥ä¾›æ²™ç®±ä¸­çš„ä»£ç ä½¿ç”¨ã€‚</li><li><strong>é”™è¯¯å¤„ç†</strong>ï¼šæä¾›é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œå¯ä»¥æ•è·æ²™ç®±ä¸­çš„å¼‚å¸¸å¹¶è¿”å›ç»™ä¸»ç¨‹åºï¼Œä¾¿äºåšé”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•ã€‚</li><li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šé€šè¿‡ä»£ç é¢„ç¼–è¯‘å’Œç¼“å­˜ï¼Œæ¥æé«˜ä»£ç æ‰§è¡Œçš„æ€§èƒ½ã€‚</li></ol><ul><li><strong>ç¼ºç‚¹ï¼š</strong></li></ul><ol><li><strong>ä¸é€‚åˆé«˜æ€§èƒ½åº”ç”¨</strong>ï¼šä¾‹å¦‚æ¸¸æˆå¼•æ“æˆ–é«˜ååé‡çš„æœåŠ¡å™¨åº”ç”¨ï¼Œæ›´é€‚åˆç›´æ¥æ‰§è¡Œä»£ç ã€‚</li><li><strong>æ— æ³•å®Œå…¨éš”ç¦»</strong>ï¼šè™½ç„¶ <strong>vm2</strong> æä¾›äº†ä¸€å®šç¨‹åº¦çš„éš”ç¦»æ€§ï¼Œä½†å®ƒä»ç„¶æ— æ³•å®Œå…¨éš”ç¦»ä»£ç ã€‚ä¸€äº›å…¨å±€å¯¹è±¡å’Œå˜é‡ä»ç„¶å¯ä»¥åœ¨æ²™ç®±ä¸­è®¿é—®ã€‚</li></ol><p><strong>isolated-vmï¼š</strong> è¿™ä¸ªnpmåº“ä¹Ÿæ˜¯vm2ä½œè€…å¼€å‘çš„ï¼Œä½œè€…è®¤ä¸ºvm2ç°åœ¨è¶Šæ¥è¶Šéš¾ç»´æŠ¤ï¼Œå·²ç»åˆ°äº†ä¸å¾—ä¸ç»ˆæ­¢é¡¹ç›®çš„åœ°æ­¥ ğŸ¤£ğŸ¤£</p><blockquote><p><img src="https://cdn.geekbuluo.com/blog/20231010/f17f9a.png" alt="">ï¼šUnfortunately, the growing complexity of Node has brought us to a crossroads. We now find ourselves facing an escape so complicated that fixing it seems impossible. And this isn&#39;t about one isolated issue. Recent reports have highlighted that sustaining this project in its current form is not viable in the long term.</p></blockquote><ul><li>ä¼˜ç‚¹ï¼š <ul><li>æä¾›æ›´é«˜çº§çš„éš”ç¦»å’Œå®‰å…¨æ€§ï¼Œå¯ä»¥åœ¨ä¸åŒçš„ V8 ä¸Šä¸‹æ–‡ä¸­è¿è¡Œä»£ç ã€‚</li><li>å…·æœ‰æ›´å¼ºå¤§çš„éš”ç¦»ï¼Œå¯ä»¥é™åˆ¶å¯¹æ¨¡å—å’Œå…¨å±€å¯¹è±¡çš„è®¿é—®ã€‚</li><li>æ›´é€‚åˆäºè¿è¡Œä¸å—ä¿¡ä»»çš„ä»£ç ã€‚</li></ul></li><li>ç¼ºç‚¹ï¼š <ul><li>è¾ƒå¤æ‚ï¼Œå­¦ä¹ æ›²çº¿è¾ƒé™¡ã€‚</li><li>æ€§èƒ½å¼€é”€è¾ƒå¤§ã€‚</li></ul></li></ul><p><strong>Dockerï¼š</strong></p><ul><li>ä¼˜ç‚¹ï¼š <ul><li>æä¾›äº†å®Œå…¨çš„å®¹å™¨éš”ç¦»ï¼Œå¯ä»¥è¿è¡Œæ•´ä¸ªåº”ç”¨ç¨‹åºç¯å¢ƒã€‚</li><li>é€‚ç”¨äºè¿è¡Œä¸å—ä¿¡ä»»çš„ä»£ç ä»¥åŠå…¶ä»–åº”ç”¨ç¨‹åºçš„éš”ç¦»éœ€æ±‚ã€‚</li></ul></li><li>ç¼ºç‚¹ï¼š <ul><li>è¾ƒé‡é‡çº§ï¼Œéœ€è¦é¢å¤–çš„ç³»ç»Ÿèµ„æºã€‚</li><li>å¯¹äºç®€å•çš„éš”ç¦»éœ€æ±‚å¯èƒ½è¿‡äºå¤æ‚</li></ul></li></ul><h2 id="åŸºäºvm2å¼€å‘ä¸ªäº‘å‡½æ•°" tabindex="-1">åŸºäºvm2å¼€å‘ä¸ªäº‘å‡½æ•° <a class="header-anchor" href="#åŸºäºvm2å¼€å‘ä¸ªäº‘å‡½æ•°" aria-label="Permalink to &quot;åŸºäºvm2å¼€å‘ä¸ªäº‘å‡½æ•°&quot;">â€‹</a></h2><h3 id="å…ˆçœ‹ä¸ªå°ä¾‹å­" tabindex="-1">å…ˆçœ‹ä¸ªå°ä¾‹å­ <a class="header-anchor" href="#å…ˆçœ‹ä¸ªå°ä¾‹å­" aria-label="Permalink to &quot;å…ˆçœ‹ä¸ªå°ä¾‹å­&quot;">â€‹</a></h3><p>å†å›åˆ°å¼€ç¯‡è¯´åˆ°çš„é‚£ä¸ªä¾‹å­ï¼š</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// ç¤ºä¾‹ï¼šç®€å•çš„äº‘å‡½æ•°</span></span>\n<span class="line"><span style="color:#79B8FF;">exports</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">handler</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">event</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">message</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;ç¬¬ä¸€ä¸ªäº‘å‡½æ•°&quot;</span><span style="color:#E1E4E8;">;</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> {</span></span>\n<span class="line"><span style="color:#E1E4E8;">    statusCode: </span><span style="color:#79B8FF;">200</span><span style="color:#E1E4E8;">,</span></span>\n<span class="line"><span style="color:#E1E4E8;">    body: { message, event },</span></span>\n<span class="line"><span style="color:#E1E4E8;">  };</span></span>\n<span class="line"><span style="color:#E1E4E8;">};</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// ç¤ºä¾‹ï¼šç®€å•çš„äº‘å‡½æ•°</span></span>\n<span class="line"><span style="color:#005CC5;">exports</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">handler</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">async</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">event</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">message</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;ç¬¬ä¸€ä¸ªäº‘å‡½æ•°&quot;</span><span style="color:#24292E;">;</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> {</span></span>\n<span class="line"><span style="color:#24292E;">    statusCode: </span><span style="color:#005CC5;">200</span><span style="color:#24292E;">,</span></span>\n<span class="line"><span style="color:#24292E;">    body: { message, event },</span></span>\n<span class="line"><span style="color:#24292E;">  };</span></span>\n<span class="line"><span style="color:#24292E;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>ä¸‹é¢æ˜¯å®ç°ä»¥ä¸Šä¾‹å­çš„code</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Koa</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;koa&#39;</span><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">KoaStatic</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;koa-static&#39;</span><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Router</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;koa-router&#39;</span><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">bodyParser</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;koa-bodyparser&#39;</span><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">path</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;path&#39;</span><span style="color:#E1E4E8;">);</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">NodeVM</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;vm2&#39;</span><span style="color:#E1E4E8;">);</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">vm</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">NodeVM</span><span style="color:#E1E4E8;">({</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// wrapper: &#39;none&#39;,</span></span>\n<span class="line"><span style="color:#E1E4E8;">});</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">app</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Koa</span><span style="color:#E1E4E8;">();</span></span>\n<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">router</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Router</span><span style="color:#E1E4E8;">();</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#E1E4E8;">router.</span><span style="color:#B392F0;">post</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;/cloud/test&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">ctx</span><span style="color:#E1E4E8;">) {</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">script</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> ctx.request.body;</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> vm.</span><span style="color:#B392F0;">run</span><span style="color:#E1E4E8;">(script);</span></span>\n<span class="line"><span style="color:#E1E4E8;">  ctx.body </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> { result: a.</span><span style="color:#B392F0;">handler</span><span style="color:#E1E4E8;">() };</span></span>\n<span class="line"><span style="color:#E1E4E8;">});</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">serve</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">KoaStatic</span><span style="color:#E1E4E8;">(path.</span><span style="color:#B392F0;">join</span><span style="color:#E1E4E8;">(__dirname, </span><span style="color:#9ECBFF;">&#39;./public&#39;</span><span style="color:#E1E4E8;">));</span></span>\n<span class="line"><span style="color:#E1E4E8;">app.</span><span style="color:#B392F0;">use</span><span style="color:#E1E4E8;">(serve);</span></span>\n<span class="line"><span style="color:#E1E4E8;">app.</span><span style="color:#B392F0;">use</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">bodyParser</span><span style="color:#E1E4E8;">());</span></span>\n<span class="line"><span style="color:#E1E4E8;">app.</span><span style="color:#B392F0;">use</span><span style="color:#E1E4E8;">(router.</span><span style="color:#B392F0;">routes</span><span style="color:#E1E4E8;">()).</span><span style="color:#B392F0;">use</span><span style="color:#E1E4E8;">(router.</span><span style="color:#B392F0;">allowedMethods</span><span style="color:#E1E4E8;">());</span></span>\n<span class="line"><span style="color:#E1E4E8;">app.</span><span style="color:#B392F0;">listen</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">8003</span><span style="color:#E1E4E8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Koa</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;koa&#39;</span><span style="color:#24292E;">);</span></span>\n<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">KoaStatic</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;koa-static&#39;</span><span style="color:#24292E;">);</span></span>\n<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Router</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;koa-router&#39;</span><span style="color:#24292E;">);</span></span>\n<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">bodyParser</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;koa-bodyparser&#39;</span><span style="color:#24292E;">);</span></span>\n<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">path</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;path&#39;</span><span style="color:#24292E;">);</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> { </span><span style="color:#005CC5;">NodeVM</span><span style="color:#24292E;"> } </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;vm2&#39;</span><span style="color:#24292E;">);</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">vm</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">NodeVM</span><span style="color:#24292E;">({</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// wrapper: &#39;none&#39;,</span></span>\n<span class="line"><span style="color:#24292E;">});</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">app</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Koa</span><span style="color:#24292E;">();</span></span>\n<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">router</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Router</span><span style="color:#24292E;">();</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#24292E;">router.</span><span style="color:#6F42C1;">post</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;/cloud/test&#39;</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">async</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">ctx</span><span style="color:#24292E;">) {</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> { </span><span style="color:#005CC5;">script</span><span style="color:#24292E;"> } </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> ctx.request.body;</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">a</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> vm.</span><span style="color:#6F42C1;">run</span><span style="color:#24292E;">(script);</span></span>\n<span class="line"><span style="color:#24292E;">  ctx.body </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> { result: a.</span><span style="color:#6F42C1;">handler</span><span style="color:#24292E;">() };</span></span>\n<span class="line"><span style="color:#24292E;">});</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">serve</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">KoaStatic</span><span style="color:#24292E;">(path.</span><span style="color:#6F42C1;">join</span><span style="color:#24292E;">(__dirname, </span><span style="color:#032F62;">&#39;./public&#39;</span><span style="color:#24292E;">));</span></span>\n<span class="line"><span style="color:#24292E;">app.</span><span style="color:#6F42C1;">use</span><span style="color:#24292E;">(serve);</span></span>\n<span class="line"><span style="color:#24292E;">app.</span><span style="color:#6F42C1;">use</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">bodyParser</span><span style="color:#24292E;">());</span></span>\n<span class="line"><span style="color:#24292E;">app.</span><span style="color:#6F42C1;">use</span><span style="color:#24292E;">(router.</span><span style="color:#6F42C1;">routes</span><span style="color:#24292E;">()).</span><span style="color:#6F42C1;">use</span><span style="color:#24292E;">(router.</span><span style="color:#6F42C1;">allowedMethods</span><span style="color:#24292E;">());</span></span>\n<span class="line"><span style="color:#24292E;">app.</span><span style="color:#6F42C1;">listen</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">8003</span><span style="color:#24292E;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>ä½¿ç”¨postmanæµ‹è¯•ï¼Œå¯ä»¥æ­£å¸¸æ‰§è¡Œï¼š <img src="https://cdn.geekbuluo.com/blog/20231010/e0ed49.png" alt="image.png"></p><h3 id="å®ç°ä¸€ä¸ªåŠŸèƒ½ç›¸å¯¹å®Œå–„çš„äº‘å‡½æ•°æœåŠ¡" tabindex="-1">å®ç°ä¸€ä¸ªåŠŸèƒ½ç›¸å¯¹å®Œå–„çš„äº‘å‡½æ•°æœåŠ¡ <a class="header-anchor" href="#å®ç°ä¸€ä¸ªåŠŸèƒ½ç›¸å¯¹å®Œå–„çš„äº‘å‡½æ•°æœåŠ¡" aria-label="Permalink to &quot;å®ç°ä¸€ä¸ªåŠŸèƒ½ç›¸å¯¹å®Œå–„çš„äº‘å‡½æ•°æœåŠ¡&quot;">â€‹</a></h3><p><img src="https://cdn.geekbuluo.com/blog/20231010/202e04.png" alt=""></p><ol><li><strong>å…ˆæ•´ä¸€ä¸ªäº‘å‡½æ•°æ¨¡ç‰ˆ</strong></li></ol><p>å…³é”®æ­¥éª¤ï¼š</p><ol><li>åˆ›å»ºé€šé…ç¬¦è·¯ç”±ï¼š/cloud/:funcNameï¼ŒfuncNameï¼šäº‘å‡½æ•°åç§°</li><li>å®ç°ä¸€ä¸ªé€šç”¨å…³é—­åº”ç”¨æ¥å£shutdown</li><li>ç¡®å®šå¤–éƒ¨æ¨¡å—å¼•å…¥æ‰“æ ‡ä½ç½®ï¼Œç¤ºä¾‹ä¸º9ï¼Œ29ï¼ˆè¿™ä¸ªåé¢ç”¨åˆ°ï¼‰</li></ol><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Koa</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;koa&#39;</span><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Router</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;koa-router&#39;</span><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">KoaStatic</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;koa-static&#39;</span><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">cors</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;@koa/cors&#39;</span><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">bodyParser</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;koa-bodyparser&#39;</span><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">path</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;path&#39;</span><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">fs</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;fs&#39;</span><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">NodeVM</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;vm2&#39;</span><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#6A737D;">/** ä¾èµ–åº“ï¼Œæ‰“æ ‡ä½ç½® */</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">query</span><span style="color:#E1E4E8;">() {</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">jsonStr</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fs.</span><span style="color:#B392F0;">readFileSync</span><span style="color:#E1E4E8;">(path.</span><span style="color:#B392F0;">join</span><span style="color:#E1E4E8;">(__dirname, </span><span style="color:#9ECBFF;">`../db/func.json`</span><span style="color:#E1E4E8;">)).</span><span style="color:#B392F0;">toString</span><span style="color:#E1E4E8;">();</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">try</span><span style="color:#E1E4E8;"> {</span></span>\n<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">JSON</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">parse</span><span style="color:#E1E4E8;">(jsonStr);</span></span>\n<span class="line"><span style="color:#E1E4E8;">  } </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (error) {</span></span>\n<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">;</span></span>\n<span class="line"><span style="color:#E1E4E8;">  }</span></span>\n<span class="line"><span style="color:#E1E4E8;">}</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">app</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Koa</span><span style="color:#E1E4E8;">();</span></span>\n<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">router</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Router</span><span style="color:#E1E4E8;">();</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">vm</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">NodeVM</span><span style="color:#E1E4E8;">({</span></span>\n<span class="line"><span style="color:#E1E4E8;">  require: {</span></span>\n<span class="line"><span style="color:#E1E4E8;">    external: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">,</span></span>\n<span class="line"><span style="color:#E1E4E8;">    root: </span><span style="color:#9ECBFF;">&#39;./&#39;</span><span style="color:#E1E4E8;">,</span></span>\n<span class="line"><span style="color:#E1E4E8;">  },</span></span>\n<span class="line"><span style="color:#E1E4E8;">  sandbox: {</span></span>\n<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// æ¬¡æ•°æ’å…¥ä¾èµ–ï¼Œ æ‰“æ ‡ä½ç½®</span></span>\n<span class="line"><span style="color:#E1E4E8;">  },</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// wrapper: &#39;node&#39;,</span></span>\n<span class="line"><span style="color:#E1E4E8;">});</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#E1E4E8;">router.</span><span style="color:#B392F0;">post</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;/cloud/:funcName&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">ctx</span><span style="color:#E1E4E8;">) {</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">funcName</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> ctx.params.funcName;</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">body</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> ctx.request;</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">cloud</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">query</span><span style="color:#E1E4E8;">() </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> {};</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">result</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> vm.</span><span style="color:#B392F0;">run</span><span style="color:#E1E4E8;">(cloud.script);</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">try</span><span style="color:#E1E4E8;"> {</span></span>\n<span class="line"><span style="color:#E1E4E8;">    ctx.body </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> result.</span><span style="color:#B392F0;">handler</span><span style="color:#E1E4E8;">(body);</span></span>\n<span class="line"><span style="color:#E1E4E8;">  } </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (error) {</span></span>\n<span class="line"><span style="color:#E1E4E8;">    ctx.body </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> { message: error.message };</span></span>\n<span class="line"><span style="color:#E1E4E8;">  }</span></span>\n<span class="line"><span style="color:#E1E4E8;">});</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#E1E4E8;">router.</span><span style="color:#B392F0;">post</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;/shutdown&#39;</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">req</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">res</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// åœ¨è¿™é‡Œæ‰§è¡Œå…³é—­æ“ä½œ</span></span>\n<span class="line"><span style="color:#E1E4E8;">  app.</span><span style="color:#B392F0;">close</span><span style="color:#E1E4E8;">(() </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>\n<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;Server has been shut down.&#39;</span><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#E1E4E8;">  });</span></span>\n<span class="line"><span style="color:#E1E4E8;">});</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#E1E4E8;">app.</span><span style="color:#B392F0;">use</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">bodyParser</span><span style="color:#E1E4E8;">());</span></span>\n<span class="line"><span style="color:#E1E4E8;">app.</span><span style="color:#B392F0;">use</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">cors</span><span style="color:#E1E4E8;">());</span></span>\n<span class="line"><span style="color:#E1E4E8;">app.</span><span style="color:#B392F0;">use</span><span style="color:#E1E4E8;">(router.</span><span style="color:#B392F0;">routes</span><span style="color:#E1E4E8;">()).</span><span style="color:#B392F0;">use</span><span style="color:#E1E4E8;">(router.</span><span style="color:#B392F0;">allowedMethods</span><span style="color:#E1E4E8;">());</span></span>\n<span class="line"><span style="color:#E1E4E8;">app.</span><span style="color:#B392F0;">listen</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">8001</span><span style="color:#E1E4E8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Koa</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;koa&#39;</span><span style="color:#24292E;">);</span></span>\n<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Router</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;koa-router&#39;</span><span style="color:#24292E;">);</span></span>\n<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">KoaStatic</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;koa-static&#39;</span><span style="color:#24292E;">);</span></span>\n<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">cors</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;@koa/cors&#39;</span><span style="color:#24292E;">);</span></span>\n<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">bodyParser</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;koa-bodyparser&#39;</span><span style="color:#24292E;">);</span></span>\n<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">path</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;path&#39;</span><span style="color:#24292E;">);</span></span>\n<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">fs</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;fs&#39;</span><span style="color:#24292E;">);</span></span>\n<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> { </span><span style="color:#005CC5;">NodeVM</span><span style="color:#24292E;"> } </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;vm2&#39;</span><span style="color:#24292E;">);</span></span>\n<span class="line"><span style="color:#6A737D;">/** ä¾èµ–åº“ï¼Œæ‰“æ ‡ä½ç½® */</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">query</span><span style="color:#24292E;">() {</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">jsonStr</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fs.</span><span style="color:#6F42C1;">readFileSync</span><span style="color:#24292E;">(path.</span><span style="color:#6F42C1;">join</span><span style="color:#24292E;">(__dirname, </span><span style="color:#032F62;">`../db/func.json`</span><span style="color:#24292E;">)).</span><span style="color:#6F42C1;">toString</span><span style="color:#24292E;">();</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">try</span><span style="color:#24292E;"> {</span></span>\n<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">JSON</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">parse</span><span style="color:#24292E;">(jsonStr);</span></span>\n<span class="line"><span style="color:#24292E;">  } </span><span style="color:#D73A49;">catch</span><span style="color:#24292E;"> (error) {</span></span>\n<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">;</span></span>\n<span class="line"><span style="color:#24292E;">  }</span></span>\n<span class="line"><span style="color:#24292E;">}</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">app</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Koa</span><span style="color:#24292E;">();</span></span>\n<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">router</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Router</span><span style="color:#24292E;">();</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">vm</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">NodeVM</span><span style="color:#24292E;">({</span></span>\n<span class="line"><span style="color:#24292E;">  require: {</span></span>\n<span class="line"><span style="color:#24292E;">    external: </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">,</span></span>\n<span class="line"><span style="color:#24292E;">    root: </span><span style="color:#032F62;">&#39;./&#39;</span><span style="color:#24292E;">,</span></span>\n<span class="line"><span style="color:#24292E;">  },</span></span>\n<span class="line"><span style="color:#24292E;">  sandbox: {</span></span>\n<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// æ¬¡æ•°æ’å…¥ä¾èµ–ï¼Œ æ‰“æ ‡ä½ç½®</span></span>\n<span class="line"><span style="color:#24292E;">  },</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// wrapper: &#39;node&#39;,</span></span>\n<span class="line"><span style="color:#24292E;">});</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#24292E;">router.</span><span style="color:#6F42C1;">post</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;/cloud/:funcName&#39;</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">async</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">ctx</span><span style="color:#24292E;">) {</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">funcName</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> ctx.params.funcName;</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> { </span><span style="color:#005CC5;">body</span><span style="color:#24292E;"> } </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> ctx.request;</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">cloud</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">query</span><span style="color:#24292E;">() </span><span style="color:#D73A49;">||</span><span style="color:#24292E;"> {};</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">result</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> vm.</span><span style="color:#6F42C1;">run</span><span style="color:#24292E;">(cloud.script);</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">try</span><span style="color:#24292E;"> {</span></span>\n<span class="line"><span style="color:#24292E;">    ctx.body </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> result.</span><span style="color:#6F42C1;">handler</span><span style="color:#24292E;">(body);</span></span>\n<span class="line"><span style="color:#24292E;">  } </span><span style="color:#D73A49;">catch</span><span style="color:#24292E;"> (error) {</span></span>\n<span class="line"><span style="color:#24292E;">    ctx.body </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> { message: error.message };</span></span>\n<span class="line"><span style="color:#24292E;">  }</span></span>\n<span class="line"><span style="color:#24292E;">});</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#24292E;">router.</span><span style="color:#6F42C1;">post</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;/shutdown&#39;</span><span style="color:#24292E;">, (</span><span style="color:#E36209;">req</span><span style="color:#24292E;">, </span><span style="color:#E36209;">res</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// åœ¨è¿™é‡Œæ‰§è¡Œå…³é—­æ“ä½œ</span></span>\n<span class="line"><span style="color:#24292E;">  app.</span><span style="color:#6F42C1;">close</span><span style="color:#24292E;">(() </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>\n<span class="line"><span style="color:#24292E;">    console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;Server has been shut down.&#39;</span><span style="color:#24292E;">);</span></span>\n<span class="line"><span style="color:#24292E;">  });</span></span>\n<span class="line"><span style="color:#24292E;">});</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#24292E;">app.</span><span style="color:#6F42C1;">use</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">bodyParser</span><span style="color:#24292E;">());</span></span>\n<span class="line"><span style="color:#24292E;">app.</span><span style="color:#6F42C1;">use</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">cors</span><span style="color:#24292E;">());</span></span>\n<span class="line"><span style="color:#24292E;">app.</span><span style="color:#6F42C1;">use</span><span style="color:#24292E;">(router.</span><span style="color:#6F42C1;">routes</span><span style="color:#24292E;">()).</span><span style="color:#6F42C1;">use</span><span style="color:#24292E;">(router.</span><span style="color:#6F42C1;">allowedMethods</span><span style="color:#24292E;">());</span></span>\n<span class="line"><span style="color:#24292E;">app.</span><span style="color:#6F42C1;">listen</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">8001</span><span style="color:#24292E;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><ol start="2"><li><strong>åˆ›å»ºäº‘å‡½æ•°</strong></li></ol><p>å‚è€ƒä¸Šé¢koaæ ‡å‡†æ¨¡ç‰ˆï¼Œæ„å»ºä¸€ä¸ªäº‘å‡½æ•°ç®¡ç†æœåŠ¡ å…³é”®æ­¥éª¤ï¼š</p><ol><li>ç®€å•èµ·è§ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨jsonæ–‡ä»¶å­˜å‚¨äº‘å‡½æ•°</li><li>åˆ›å»ºæˆåŠŸåæ”¹å‡½æ•°åå°±ä¸èƒ½è¢«å…¶ä»–äººåœ¨ä½¿ç”¨</li></ol><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">router.</span><span style="color:#B392F0;">post</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;/cloud/create&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">ctx</span><span style="color:#E1E4E8;">) {</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">body</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> ctx.request;</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">save</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">`../db/func.json`</span><span style="color:#E1E4E8;">, { funcName: body.funcName });</span></span>\n<span class="line"><span style="color:#E1E4E8;">  ctx.body </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> { code: </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">, msg: </span><span style="color:#9ECBFF;">&#39;npm install sunccess&#39;</span><span style="color:#E1E4E8;"> };</span></span>\n<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">router.</span><span style="color:#6F42C1;">post</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;/cloud/create&#39;</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">async</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">ctx</span><span style="color:#24292E;">) {</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> { </span><span style="color:#005CC5;">body</span><span style="color:#24292E;"> } </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> ctx.request;</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">save</span><span style="color:#24292E;">(</span><span style="color:#032F62;">`../db/func.json`</span><span style="color:#24292E;">, { funcName: body.funcName });</span></span>\n<span class="line"><span style="color:#24292E;">  ctx.body </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> { code: </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">, msg: </span><span style="color:#032F62;">&#39;npm install sunccess&#39;</span><span style="color:#24292E;"> };</span></span>\n<span class="line"><span style="color:#24292E;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="3"><li><strong>å®ç°äº‘å‡½æ•°å¹¶è¿è¡Œ</strong></li></ol><p>å…³é”®æ­¥éª¤ï¼š</p><ol><li>æ ¡éªŒäº‘å‡½æ•°åˆæ³•æ€§</li><li>æŠŠäº‘å‡½æ•°å®ç°å†…å®¹å­˜å‚¨åˆ°åˆšåˆ›å»ºçš„äº‘å‡½æ•°ä¸­</li><li>é€šè¿‡child_processæä¾›çš„spawnæ–¹æ³•å¯åŠ¨ä¸€ä¸ªå­è¿›ç¨‹è¿è¡Œåˆšåˆ›å»ºçš„äº‘å‡½æ•°æœåŠ¡</li></ol><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">router.</span><span style="color:#B392F0;">post</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;/cloud/save&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">ctx</span><span style="color:#E1E4E8;">) {</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">body</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> ctx.request;</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// æ ¡éªŒé€»è¾‘çœç•¥</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">cloud</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">query</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">`../db/func.json`</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> {};</span></span>\n<span class="line"><span style="color:#E1E4E8;">  cloud.script </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> body.script;</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">save</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">`../db/func.json`</span><span style="color:#E1E4E8;">, cloud);</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// å­è¿›ç¨‹å¯åŠ¨nodeæœåŠ¡</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">nodeStart</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">`../cloudFunction/vm2.js`</span><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#E1E4E8;">  ctx.body </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> { code: </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">, msg: </span><span style="color:#9ECBFF;">&#39;func is run&#39;</span><span style="color:#E1E4E8;"> };</span></span>\n<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">router.</span><span style="color:#6F42C1;">post</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;/cloud/save&#39;</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">async</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">ctx</span><span style="color:#24292E;">) {</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> { </span><span style="color:#005CC5;">body</span><span style="color:#24292E;"> } </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> ctx.request;</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// æ ¡éªŒé€»è¾‘çœç•¥</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">cloud</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">query</span><span style="color:#24292E;">(</span><span style="color:#032F62;">`../db/func.json`</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">||</span><span style="color:#24292E;"> {};</span></span>\n<span class="line"><span style="color:#24292E;">  cloud.script </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> body.script;</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">save</span><span style="color:#24292E;">(</span><span style="color:#032F62;">`../db/func.json`</span><span style="color:#24292E;">, cloud);</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// å­è¿›ç¨‹å¯åŠ¨nodeæœåŠ¡</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">nodeStart</span><span style="color:#24292E;">(</span><span style="color:#032F62;">`../cloudFunction/vm2.js`</span><span style="color:#24292E;">);</span></span>\n<span class="line"><span style="color:#24292E;">  ctx.body </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> { code: </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">, msg: </span><span style="color:#032F62;">&#39;func is run&#39;</span><span style="color:#24292E;"> };</span></span>\n<span class="line"><span style="color:#24292E;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ol start="4"><li><strong>å¤„ç†å¤–éƒ¨æ¨¡å—ï¼ˆnpmåŒ…ï¼‰</strong></li></ol><p>vm2é»˜è®¤æ˜¯éš”ç¦»ä¸Šä¸‹æ–‡å½“ä¸­çš„å±€éƒ¨å˜é‡æˆ–å‡½æ•°çš„ï¼Œæ­¤æ—¶å¦‚æœä¸åœ¨ç¨‹åºä¸­å®‰è£…ä¾èµ–äº‘å‡½æ•°æ˜¯æ— æ³•æ­£å¸¸è¿è¡Œçš„ï¼ŒNodeVMä¸­æä¾›sandboxå‚æ•°å¯ä»¥æ³¨å…¥ä¾èµ–çš„æ¨¡å—,æ¯”å¦‚æƒ³ä½¿ç”¨dayjsåŒ…ï¼š</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">dayjs</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(dayjs);</span></span>\n<span class="line"><span style="color:#E1E4E8;">vm </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">NodeVM</span><span style="color:#E1E4E8;">({</span></span>\n<span class="line"><span style="color:#E1E4E8;">  sandbox: {</span></span>\n<span class="line"><span style="color:#E1E4E8;">    dayjs</span></span>\n<span class="line"><span style="color:#E1E4E8;">  },</span></span>\n<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">dayjs</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(dayjs);</span></span>\n<span class="line"><span style="color:#24292E;">vm </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">NodeVM</span><span style="color:#24292E;">({</span></span>\n<span class="line"><span style="color:#24292E;">  sandbox: {</span></span>\n<span class="line"><span style="color:#24292E;">    dayjs</span></span>\n<span class="line"><span style="color:#24292E;">  },</span></span>\n<span class="line"><span style="color:#24292E;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>å…³é”®æ­¥éª¤ï¼š</p><ol><li>åˆ›å»ºå®‰è£…ä¾èµ–çš„æ¥å£</li><li>åˆ›å»ºå®‰è£…ä¾èµ–å‘½ä»¤ï¼šnpm install :npmName,å¹¶é€šè¿‡execSyncæ‰§è¡Œåˆ°äº‘å‡½æ•°æ‰€åœ¨ç›®å½•</li><li>å…³é—­å­è¿›ç¨‹ä¸­è¿è¡Œäº‘å‡½æ•°NodeæœåŠ¡</li><li>è·å–åˆšåˆ›å»ºçš„äº‘å‡½æ•°ä¸»åº”ç”¨æ–‡ä»¶ï¼Œå¹¶æŒ‰è¡Œè¿›è¡Œæ•°ç»„å¤„ç†</li><li>æ ¹æ®ä¸Šé¢æ‰“æ ‡çš„ä½ç½®ï¼ŒæŠŠè¿™ä¸¤ä¸ªä»£ç æ’å…¥äº‘å‡½æ•°æºç å¯¹åº”çš„ä½ç½®ï¼š <ol><li>const npmName = require(&#39;npmName&#39;);</li><li>npmName: npmName,</li></ol></li><li>ä¿®æ”¹è¿‡çš„æºç è¦†ç›–åŸæ¥çš„ä»£ç ï¼›</li><li>é‡æ–°é€šè¿‡spawn(&#39;node&#39;, [path.join(__dirname, &#39;äº‘å‡½æ•°ä¸»å…¥å£è·¯å¾„&#39;)])é‡å¯äº‘å‡½æ•°æœåŠ¡ï¼›</li></ol><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">router.</span><span style="color:#B392F0;">post</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;/cloud/npminstall&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">ctx</span><span style="color:#E1E4E8;">) {</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">body</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> ctx.request;</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">npmName</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> body; </span><span style="color:#6A737D;">// ç‰ˆæœ¬</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">npmCommand</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">`npm install ${</span><span style="color:#E1E4E8;">npmName</span><span style="color:#9ECBFF;">}`</span><span style="color:#E1E4E8;">;</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">execSync</span><span style="color:#E1E4E8;">(npmCommand, { cwd: </span><span style="color:#9ECBFF;">&#39;../cloudFunction&#39;</span><span style="color:#E1E4E8;"> });</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> axios.</span><span style="color:#B392F0;">post</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;http://localhost:8001/shutdown&#39;</span><span style="color:#E1E4E8;">, {});</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">cloud</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">query</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">`../db/func.json`</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> {};</span></span>\n<span class="line"><span style="color:#E1E4E8;">  cloud.npmName </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> npmName;</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">save</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">`../db/func.json`</span><span style="color:#E1E4E8;">, cloud);</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// 2.ä¿®æ”¹ä»£ç ï¼šï¼šï¼šå½“ç„¶ï¼Œå®Œæ•´åŠŸèƒ½è¿™é‡Œè¦ä¿å­˜ä»£ç å¿«ç…§ï¼Œå¯ä»¥åˆ‡æ¢å›æ»š</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// è¯»å–éœ€è¦æ·»åŠ é…ç½®è¡Œæ•°</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">line</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">query</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">`../db/config.json`</span><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">fileStr</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fs.</span><span style="color:#B392F0;">readFileSync</span><span style="color:#E1E4E8;">(path.</span><span style="color:#B392F0;">join</span><span style="color:#E1E4E8;">(__dirname, </span><span style="color:#9ECBFF;">`../cloudFunction/vm2.js`</span><span style="color:#E1E4E8;">)).</span><span style="color:#B392F0;">toString</span><span style="color:#E1E4E8;">();</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">codeLines</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fileStr.</span><span style="color:#B392F0;">split</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;</span><span style="color:#79B8FF;">\\n</span><span style="color:#9ECBFF;">&#39;</span><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#E1E4E8;">  codeLines.</span><span style="color:#B392F0;">splice</span><span style="color:#E1E4E8;">(line.requireLine, </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">`const ${</span><span style="color:#E1E4E8;">npmName</span><span style="color:#9ECBFF;">} = require(&#39;${</span><span style="color:#E1E4E8;">npmName</span><span style="color:#9ECBFF;">}&#39;);`</span><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#E1E4E8;">  codeLines.</span><span style="color:#B392F0;">splice</span><span style="color:#E1E4E8;">(line.dependLine, </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">`${</span><span style="color:#E1E4E8;">npmName</span><span style="color:#9ECBFF;">},`</span><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#E1E4E8;">  fs.</span><span style="color:#B392F0;">writeFileSync</span><span style="color:#E1E4E8;">(path.</span><span style="color:#B392F0;">join</span><span style="color:#E1E4E8;">(__dirname, </span><span style="color:#9ECBFF;">`../cloudFunction/vm2.js`</span><span style="color:#E1E4E8;">), codeLines.</span><span style="color:#B392F0;">join</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;</span><span style="color:#79B8FF;">\\n</span><span style="color:#9ECBFF;">&#39;</span><span style="color:#E1E4E8;">), </span><span style="color:#9ECBFF;">&#39;utf8&#39;</span><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// ä¿®æ”¹æºæ–‡ä»¶å¯ç¼–è¾‘è¡Œæ•°</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// line.requireLine += 1;</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// line.dependLine += 1;</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">save</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">`../db/config.json`</span><span style="color:#E1E4E8;">, line);</span></span>\n<span class="line"><span style="color:#E1E4E8;">  ctx.body </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> { code: </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">, msg: </span><span style="color:#9ECBFF;">&#39;npm install sunccess&#39;</span><span style="color:#E1E4E8;"> };</span></span>\n<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">router.</span><span style="color:#6F42C1;">post</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;/cloud/npminstall&#39;</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">async</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">ctx</span><span style="color:#24292E;">) {</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> { </span><span style="color:#005CC5;">body</span><span style="color:#24292E;"> } </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> ctx.request;</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> { </span><span style="color:#005CC5;">npmName</span><span style="color:#24292E;"> } </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> body; </span><span style="color:#6A737D;">// ç‰ˆæœ¬</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">npmCommand</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">`npm install ${</span><span style="color:#24292E;">npmName</span><span style="color:#032F62;">}`</span><span style="color:#24292E;">;</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">execSync</span><span style="color:#24292E;">(npmCommand, { cwd: </span><span style="color:#032F62;">&#39;../cloudFunction&#39;</span><span style="color:#24292E;"> });</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> axios.</span><span style="color:#6F42C1;">post</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;http://localhost:8001/shutdown&#39;</span><span style="color:#24292E;">, {});</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">cloud</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">query</span><span style="color:#24292E;">(</span><span style="color:#032F62;">`../db/func.json`</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">||</span><span style="color:#24292E;"> {};</span></span>\n<span class="line"><span style="color:#24292E;">  cloud.npmName </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> npmName;</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">save</span><span style="color:#24292E;">(</span><span style="color:#032F62;">`../db/func.json`</span><span style="color:#24292E;">, cloud);</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// 2.ä¿®æ”¹ä»£ç ï¼šï¼šï¼šå½“ç„¶ï¼Œå®Œæ•´åŠŸèƒ½è¿™é‡Œè¦ä¿å­˜ä»£ç å¿«ç…§ï¼Œå¯ä»¥åˆ‡æ¢å›æ»š</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// è¯»å–éœ€è¦æ·»åŠ é…ç½®è¡Œæ•°</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">line</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">query</span><span style="color:#24292E;">(</span><span style="color:#032F62;">`../db/config.json`</span><span style="color:#24292E;">);</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">fileStr</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fs.</span><span style="color:#6F42C1;">readFileSync</span><span style="color:#24292E;">(path.</span><span style="color:#6F42C1;">join</span><span style="color:#24292E;">(__dirname, </span><span style="color:#032F62;">`../cloudFunction/vm2.js`</span><span style="color:#24292E;">)).</span><span style="color:#6F42C1;">toString</span><span style="color:#24292E;">();</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">codeLines</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fileStr.</span><span style="color:#6F42C1;">split</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;</span><span style="color:#005CC5;">\\n</span><span style="color:#032F62;">&#39;</span><span style="color:#24292E;">);</span></span>\n<span class="line"><span style="color:#24292E;">  codeLines.</span><span style="color:#6F42C1;">splice</span><span style="color:#24292E;">(line.requireLine, </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">, </span><span style="color:#032F62;">`const ${</span><span style="color:#24292E;">npmName</span><span style="color:#032F62;">} = require(&#39;${</span><span style="color:#24292E;">npmName</span><span style="color:#032F62;">}&#39;);`</span><span style="color:#24292E;">);</span></span>\n<span class="line"><span style="color:#24292E;">  codeLines.</span><span style="color:#6F42C1;">splice</span><span style="color:#24292E;">(line.dependLine, </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">, </span><span style="color:#032F62;">`${</span><span style="color:#24292E;">npmName</span><span style="color:#032F62;">},`</span><span style="color:#24292E;">);</span></span>\n<span class="line"><span style="color:#24292E;">  fs.</span><span style="color:#6F42C1;">writeFileSync</span><span style="color:#24292E;">(path.</span><span style="color:#6F42C1;">join</span><span style="color:#24292E;">(__dirname, </span><span style="color:#032F62;">`../cloudFunction/vm2.js`</span><span style="color:#24292E;">), codeLines.</span><span style="color:#6F42C1;">join</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;</span><span style="color:#005CC5;">\\n</span><span style="color:#032F62;">&#39;</span><span style="color:#24292E;">), </span><span style="color:#032F62;">&#39;utf8&#39;</span><span style="color:#24292E;">);</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// ä¿®æ”¹æºæ–‡ä»¶å¯ç¼–è¾‘è¡Œæ•°</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// line.requireLine += 1;</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// line.dependLine += 1;</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">save</span><span style="color:#24292E;">(</span><span style="color:#032F62;">`../db/config.json`</span><span style="color:#24292E;">, line);</span></span>\n<span class="line"><span style="color:#24292E;">  ctx.body </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> { code: </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">, msg: </span><span style="color:#032F62;">&#39;npm install sunccess&#39;</span><span style="color:#24292E;"> };</span></span>\n<span class="line"><span style="color:#24292E;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ä¸ªç®€æ˜“ç‰ˆçš„äº‘å‡½æ•°ï¼›è¿™é‡Œæ“ä½œäº‘å‡½æ•°æœåŠ¡éƒ½æ˜¯é€šè¿‡nodeçš„å­è¿›ç¨‹å®ç°çš„ï¼Œåœ¨é«˜å¹¶å‘ä¸‹å…¶å®æ˜¯æŒºåƒå†…å­˜çš„ï¼Œå¦‚æœæƒ³åœ¨ç”Ÿäº§ä¸Šåº”ç”¨ï¼ŒæŠŠäº‘å‡½æ•°éƒ¨ç½²åˆ°dockerå®¹å™¨ä¸­æ˜¯æ¯”è¾ƒå¥½çš„é€‰æ‹©ï¼›dockerèƒ½å¤Ÿå®Œå…¨å®ç°éš”ç¦»ï¼Œå¹¶ä¸”ä¸å—ä¸»åº”ç”¨æœåŠ¡å†…å­˜å½±å“ï¼Œç¨³å®šæ€§ä¹Ÿä¼šæ¯”è¾ƒé«˜ï¼›</p><h3 id="å®‰å…¨é˜²æŠ¤" tabindex="-1">å®‰å…¨é˜²æŠ¤ <a class="header-anchor" href="#å®‰å…¨é˜²æŠ¤" aria-label="Permalink to &quot;å®‰å…¨é˜²æŠ¤&quot;">â€‹</a></h3><ol><li><strong>é™åˆ¶èµ„æºè®¿é—®</strong>ï¼šä½¿ç”¨ <strong>vm2</strong> çš„ <strong>NodeVM</strong>æ—¶ï¼Œå¯ä»¥é…ç½®é€‰é¡¹æ¥é™åˆ¶ä»£ç å¯¹ç³»ç»Ÿèµ„æºçš„è®¿é—®æƒé™ã€‚é€šè¿‡è®¾ç½® <strong>sandbox</strong> é€‰é¡¹ï¼Œå¯ä»¥é™åˆ¶è„šæœ¬å¯¹å…¨å±€å¯¹è±¡çš„è®¿é—®ï¼Œä»¥åŠç¦ç”¨å¯¹æŸäº›æ•æ„Ÿæ¨¡å—çš„è®¿é—®ã€‚ä¾‹å¦‚ï¼š</li></ol><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">NodeVM</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;vm2&#39;</span><span style="color:#E1E4E8;">);</span></span>\n<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">vm</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">NodeVM</span><span style="color:#E1E4E8;">({</span></span>\n<span class="line"><span style="color:#E1E4E8;">  sandbox: {</span></span>\n<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// åœ¨æ²™ç®±ä¸­ç¦ç”¨å…¨å±€å¯¹è±¡è®¿é—®</span></span>\n<span class="line"><span style="color:#E1E4E8;">    console: </span><span style="color:#9ECBFF;">&#39;off&#39;</span><span style="color:#E1E4E8;">,</span></span>\n<span class="line"><span style="color:#E1E4E8;">    process: </span><span style="color:#9ECBFF;">&#39;off&#39;</span><span style="color:#E1E4E8;">,</span></span>\n<span class="line"><span style="color:#E1E4E8;">    timeout: </span><span style="color:#79B8FF;">1000</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">//è¶…æ—¶æ—¶é—´</span></span>\n<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// é™åˆ¶å¯¹ fs æ¨¡å—çš„è®¿é—®</span></span>\n<span class="line"><span style="color:#E1E4E8;">    fs: {</span></span>\n<span class="line"><span style="color:#E1E4E8;">      readFileSync: </span><span style="color:#9ECBFF;">&#39;readonly&#39;</span><span style="color:#E1E4E8;">,</span></span>\n<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">// å…¶ä»–æ–¹æ³•å¯è®¾ç½®ä¸º &#39;off&#39;ï¼Œç¦æ­¢è®¿é—®</span></span>\n<span class="line"><span style="color:#E1E4E8;">    },</span></span>\n<span class="line"><span style="color:#E1E4E8;">  },</span></span>\n<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> { </span><span style="color:#005CC5;">NodeVM</span><span style="color:#24292E;"> } </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;vm2&#39;</span><span style="color:#24292E;">);</span></span>\n<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">vm</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">NodeVM</span><span style="color:#24292E;">({</span></span>\n<span class="line"><span style="color:#24292E;">  sandbox: {</span></span>\n<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// åœ¨æ²™ç®±ä¸­ç¦ç”¨å…¨å±€å¯¹è±¡è®¿é—®</span></span>\n<span class="line"><span style="color:#24292E;">    console: </span><span style="color:#032F62;">&#39;off&#39;</span><span style="color:#24292E;">,</span></span>\n<span class="line"><span style="color:#24292E;">    process: </span><span style="color:#032F62;">&#39;off&#39;</span><span style="color:#24292E;">,</span></span>\n<span class="line"><span style="color:#24292E;">    timeout: </span><span style="color:#005CC5;">1000</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">//è¶…æ—¶æ—¶é—´</span></span>\n<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// é™åˆ¶å¯¹ fs æ¨¡å—çš„è®¿é—®</span></span>\n<span class="line"><span style="color:#24292E;">    fs: {</span></span>\n<span class="line"><span style="color:#24292E;">      readFileSync: </span><span style="color:#032F62;">&#39;readonly&#39;</span><span style="color:#24292E;">,</span></span>\n<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">// å…¶ä»–æ–¹æ³•å¯è®¾ç½®ä¸º &#39;off&#39;ï¼Œç¦æ­¢è®¿é—®</span></span>\n<span class="line"><span style="color:#24292E;">    },</span></span>\n<span class="line"><span style="color:#24292E;">  },</span></span>\n<span class="line"><span style="color:#24292E;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ol start="2"><li><strong>éš”ç¦»ç¯å¢ƒ</strong>ï¼šä½¿ç”¨ <strong>NodeVM</strong> åˆ›å»ºéš”ç¦»çš„æ²™ç®±ç¯å¢ƒï¼Œä»¥ç¡®ä¿è„šæœ¬çš„æ‰§è¡Œä¸ä¼šå½±å“ä¸»åº”ç”¨ç¨‹åºã€‚è¿™å¯ä»¥é€šè¿‡åˆ›å»ºå¤šä¸ªç‹¬ç«‹çš„ <strong>NodeVM</strong> å®ä¾‹æ¥å®ç°ï¼Œæ¯ä¸ªå®ä¾‹éƒ½æœ‰è‡ªå·±çš„æ²™ç®±ç¯å¢ƒã€‚</li><li><strong>é™åˆ¶è¿è¡Œæ—¶é—´</strong>ï¼šä½¿ç”¨ <strong>timeout</strong> é€‰é¡¹æ¥é™åˆ¶ä»£ç çš„è¿è¡Œæ—¶é—´ï¼Œä»¥é˜²æ­¢æ— é™å¾ªç¯æˆ–é•¿æ—¶é—´è¿è¡Œçš„ä»£ç å ç”¨èµ„æºã€‚</li><li><strong>ç™½åå•æ–¹æ³•</strong>ï¼šåªæš´éœ²ç»™æ²™ç®±ç¯å¢ƒå¿…è¦çš„æ–¹æ³•å’Œæ¨¡å—ï¼Œé€šè¿‡ç™½åå•æ–¹å¼é™åˆ¶å…¶å®ƒæ–¹æ³•å’Œæ¨¡å—çš„è®¿é—®ã€‚</li><li><strong>ç›‘æ§å’Œæ—¥å¿—</strong>ï¼šåœ¨æ²™ç®±ç¯å¢ƒä¸­è®¾ç½®äº‹ä»¶ç›‘å¬å™¨ï¼Œä»¥ä¾¿ç›‘æ§ä»£ç çš„è¡Œä¸ºã€‚åŒæ—¶ï¼Œè®°å½•ä»£ç æ‰§è¡Œçš„æ—¥å¿—å’Œé”™è¯¯ä¿¡æ¯ï¼Œä»¥ä¾¿æ£€æŸ¥å’Œæ’é™¤é—®é¢˜ã€‚</li><li><strong>å®šæœŸå®¡æŸ¥ä»£ç </strong>ï¼šå®šæœŸå®¡æŸ¥å…è®¸åœ¨æ²™ç®±ä¸­è¿è¡Œçš„ä»£ç ï¼Œä»¥ç¡®ä¿å…¶å®‰å…¨æ€§å’Œåˆè§„æ€§ã€‚</li><li><strong>ä½¿ç”¨å¯ä¿¡èµ–çš„åº“</strong>ï¼šé¿å…åœ¨æ²™ç®±ä¸­ä½¿ç”¨ä¸å—ä¿¡ä»»æˆ–ä¸å®‰å…¨çš„ç¬¬ä¸‰æ–¹åº“ï¼Œå°½å¯èƒ½ä½¿ç”¨å—ä¿¡ä»»çš„åº“ã€‚</li></ol><h1 id="æ€»ç»“" tabindex="-1">æ€»ç»“ <a class="header-anchor" href="#æ€»ç»“" aria-label="Permalink to &quot;æ€»ç»“&quot;">â€‹</a></h1>',70),b=e("p",null,"ä½¿ç”¨äº‘å‡½æ•°æ¨¡å¼å¼€å‘æœ‰æ¯”è¾ƒå¤šçš„å¥½å¤„ï¼Œæ¯ä¸ªäº‘å‡½æ•°æœ‰ç‹¬ç«‹çš„æ²™ç®±ç¯å¢ƒï¼Œä¸ä¸»ç¨‹åºéš”ç¦»ï¼Œçµæ´»æ€§å¤§å¤§æé«˜ï¼Œå¯æ‹“å±•æ€§ä¹Ÿæ¯”è¾ƒé«˜ï¼Œæ¯”å¦‚åŠ¨æ€åœ°æ·»åŠ ã€æ›´æ–°å’Œåˆ é™¤äº‘å‡½æ•°ï¼Œè€Œæ— éœ€é‡æ–°å¯åŠ¨ä¸»åº”ç”¨ç¨‹åºã€‚",-1);const m=s(E,[["render",function(s,e,c,r,t,E){const m=n("ArticleMetadata"),C=n("ClientOnly");return a(),l("div",null,[y,p(C,null,{default:o((()=>[p(m)])),_:1}),i,p(C,null,{default:o((()=>[p(m)])),_:1}),F,u,p(C,null,{default:o((()=>[p(m)])),_:1}),d,p(C,null,{default:o((()=>[p(m)])),_:1}),b])}]]);export{t as __pageData,m as default};
